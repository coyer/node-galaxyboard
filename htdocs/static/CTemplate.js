var CTemplate; (function(){CTemplate==null&&(CTemplate={});if(CTemplate.evalEx==null)CTemplate.evalEx=function(a){return eval(a)};if(Array.prototype.pop==null)Array.prototype.pop=function(){if(this.length!==0)return this[--this.length]};if(Array.prototype.push==null)Array.prototype.push=function(){for(var a=0;a<arguments.length;++a)this[this.length]=arguments[a];return this.length};CTemplate.parseTemplate=function(a,b,c){if(c==null)c=CTemplate.parseTemplate_etc;var g,d;g=c;d=a.replace(/\t/g," ");d=d.replace(/\r\n/g, "\n");d=d.replace(/\r/g,"\n");d=d.replace(/^(\s*\S*(\s+\S+)*)\s*$/,"$1");for(var l=["var CTemplate_Template_TEMP = function(_OUT, _CONTEXT, _FLAGS) { with (_CONTEXT) {"],m={stack:[],line:1},h=-1;h+1<d.length;){for(var f=h,f=d.indexOf("{",f+1);f>=0;){var e=d.indexOf("}",f+1);if(e=d.substring(f,e).match(/^\{(cdata|minify|eval)/)){var e=e[1],i=f+e.length+1,j=d.indexOf("}",i);if(j>=0){var i=j-i<=0?"{/"+e+"}":d.substring(i+1,j),k=d.indexOf(i,j+1);k>=0&&(o(d.substring(h+1,f),l),h=d.substring(j+1,k),e== "cdata"?p(h,l):e=="minify"?(e=h,e=e.replace(/^\s+/g,""),e=e.replace(/\s+$/g,""),e=e.replace(/\s+/g," "),e=e.replace(/^(\s*\S*(\s+\S+)*)\s*$/,"$1"),p(e,l)):e=="eval"&&h!=null&&h.length>0&&l.push("_OUT.write( (function() { "+h+" })() );"),f=h=k+i.length-1)}}else if(d.charAt(f-1)!="$"&&d.charAt(f-1)!="\\"&&(e=d.charAt(f+1)=="/"?2:1,d.substring(f+e,f+10+e).search(CTemplate.parseTemplate_etc.statementTag)==0))break;f=d.indexOf("{",f+1)}if(f<0)break;e=d.indexOf("}",f+1);if(e<0)break;o(d.substring(h+1,f), l);var k=d.substring(f,e+1),j=m,h=l,n=b,q=g,f=k.slice(1,-1).split(" "),i=q.statementDef[f[0]];if(i==null)o(k,h);else{if(i.delta<0){if(j.stack.length<=0)throw new q.ParseError(n,j.line,"close tag does not match any previous statement: "+k);j.stack.pop()}i.delta>0&&j.stack.push(k);if(i.paramMin!=null&&i.paramMin>=f.length)throw new q.ParseError(n,j.line,"statement needs more parameters: "+k);i.prefixFunc!=null?h.push(i.prefixFunc(f,j,n,q)):h.push(i.prefix);if(i.suffix!=null){if(f.length<=1)i.paramDefault!= null&&h.push(i.paramDefault);else for(k=1;k<f.length;k++)k>1&&h.push(" "),h.push(f[k]);h.push(i.suffix)}}h=e}o(d.substring(h+1),l);if(m.stack.length!=0)throw new g.ParseError(b,m.line,"unclosed, unmatched statement(s): "+m.stack.join(","));l.push("}}; CTemplate_Template_TEMP");g=l.join("");d=CTemplate.evalEx(g,b,1);if(d!=null)return new c.Template(b,a,g,d,c);return null};try{String.prototype.process=function(a,b){var c=CTemplate.parseTemplate(this,null);if(c!=null)return c.process(a,b);return this}}catch(s){}CTemplate.parseTemplate_etc= {};CTemplate.parseTemplate_etc.statementTag="forelse|for|if|elseif|else|var|macro";CTemplate.parseTemplate_etc.statementDef={"if":{delta:1,prefix:"if (",suffix:") {",paramMin:1},"else":{delta:0,prefix:"} else {"},elseif:{delta:0,prefix:"} else if (",suffix:") {",paramDefault:"true"},"/if":{delta:-1,prefix:"}"},"for":{delta:1,paramMin:3,prefixFunc:function(a,b,c,g){if(a[2]!="in")throw new g.ParseError(c,b.line,"bad for loop statement: "+a.join(" "));b=a[1];c="__LIST__"+b;return["var ",c," = ",a[3], ";var __LENGTH_STACK__;if (typeof(__LENGTH_STACK__) == 'undefined' || !__LENGTH_STACK__.length) __LENGTH_STACK__ = new Array();__LENGTH_STACK__[__LENGTH_STACK__.length] = 0;if ((",c,") != null) { var ",b,"_ct = 0;for (var ",b,"_index in ",c,") { ",b,"_ct++;if (typeof(",c,"[",b,"_index]) == 'function') {continue;}__LENGTH_STACK__[__LENGTH_STACK__.length - 1]++;var ",b," = ",c,"[",b,"_index];"].join("")}},forelse:{delta:0,prefix:"} } if (__LENGTH_STACK__[__LENGTH_STACK__.length - 1] == 0) { if (",suffix:") {", paramDefault:"true"},"/for":{delta:-1,prefix:"} }; delete __LENGTH_STACK__[__LENGTH_STACK__.length - 1];"},"var":{delta:0,prefix:"var ",suffix:";"},macro:{delta:1,prefixFunc:function(a){var b=a[1].split("(")[0];return["var ",b," = function",a.slice(1).join(" ").substring(b.length),"{ var _OUT_arr = []; var _OUT = { write: function(m) { if (m) _OUT_arr.push(m); } }; "].join("")}},"/macro":{delta:-1,prefix:" return _OUT_arr.join(''); };"}};CTemplate.parseTemplate_etc.modifierDef={eat:function(){return""}, escape:function(a){return String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},capitalize:function(a){return String(a).toUpperCase()},"default":function(a,b){return a!=null?a:b}};CTemplate.parseTemplate_etc.modifierDef.h=CTemplate.parseTemplate_etc.modifierDef.escape;CTemplate.parseTemplate_etc.Template=function(a,b,c,g,d){this.process=function(a,b){a==null&&(a={});if(a._MODIFIERS==null)a._MODIFIERS={};if(a.defined==null)a.defined=function(b){return a[b]!=void 0};for(var c in d.modifierDef)a._MODIFIERS[c]== null&&(a._MODIFIERS[c]=d.modifierDef[c]);b==null&&(b={});var f=[];c={write:function(a){f.push(a)}};try{g(c,a,b)}catch(e){if(b.throwExceptions==!0)throw e;c=new String(f.join("")+"[ERROR: "+e.toString()+(e.message?"; "+e.message:"")+"]");c.exception=e;return c}return f.join("")};this.name=a;this.source=b;this.sourceFunc=c;this.toString=function(){return"CTemplate.Template ["+a+"]"}};CTemplate.parseTemplate_etc.ParseError=function(a,b,c){this.name=a;this.line=b;this.message=c};CTemplate.parseTemplate_etc.ParseError.prototype.toString= function(){return"CTemplate template ParseError in "+this.name+": line "+this.line+", "+this.message};var o=function(a,b){if(!(a.length<=0)){for(var c=0,g=a.length-1;c<a.length&&a.charAt(c)=="\n";)c++;for(;g>=0&&(a.charAt(g)==" "||a.charAt(g)=="\t");)g--;g<c&&(g=c);if(c>0){b.push('if (_FLAGS.keepWhitespace == true) _OUT.write("');var d=a.substring(0,c).replace(/\n/g,"\\n");d.charAt(d.length-1)=="\n"&&(d=d.substring(0,d.length-1));b.push(d);b.push('");')}c=a.substring(c,g+1).split("\n");for(d=0;d< c.length;d++){for(var l=c[d],m=b,h="}",f=-1;f+h.length<l.length;){var e="${",i="}",j=l.indexOf(e,f+h.length);if(j<0)break;l.charAt(j+2)=="%"&&(e="${%",i="%}");var k=l.indexOf(i,j+e.length);if(k<0)break;p(l.substring(f+h.length,j),m);var h=l.substring(j+e.length,k).replace(/\|\|/g,"#@@#").split("|"),n;for(n in h)h[n].replace&&(h[n]=h[n].replace(/#@@#/g,"||"));m.push("_OUT.write(");r(h,h.length-1,m);m.push(");");f=k;h=i}p(l.substring(f+h.length),m);d<c.length-1&&b.push('_OUT.write("\\n");\n')}g+1<a.length&& (b.push('if (_FLAGS.keepWhitespace == true) _OUT.write("'),d=a.substring(g+1).replace("\n","\\n"),d.charAt(d.length-1)=="\n"&&(d=d.substring(0,d.length-1)),b.push(d),b.push('");'))}},p=function(a,b){a==null||a.length<=0||(a=a.replace(/\\/g,"\\\\"),a=a.replace(/\n/g,"\\n"),a=a.replace(/"/g,'\\"'),b.push('_OUT.write("'),b.push(a),b.push('");'))},r=function(a,b,c){var g=a[b];b<=0?c.push(g):(g=g.split(":"),c.push('_MODIFIERS["'),c.push(g[0]),c.push('"]('),r(a,b-1,c),g.length>1&&(c.push(","),c.push(g[1])), c.push(")"))};CTemplate.parseDOMTemplate=function(a,b,c){b==null&&(b=document);var b=b.getElementById(a),g=b.value;if(g==null)g=b.innerHTML;g=g.replace(/&lt;/g,"<").replace(/&gt;/g,">");return CTemplate.parseTemplate(g,a,c)};CTemplate.processDOMTemplate=function(a,b,c,g,d){return CTemplate.parseDOMTemplate(a,g,d).process(b,c)}})();
